#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

int main(int argc, char* argv[]){
    int pvf[2];
    int fvp[2];

    int buf = atoi(argv[1]);

    pipe(&pvf[0]);
    pipe(&fvp[0]);

    if (fork()==0){
        close(pvf[1]);
        close(fvp[0]);

        read(pvf[0], &buf, sizeof(int));

        printf("Reception de %d sur le processus %d\n", buf, getpid());
        buf *= 2;
        printf("Envoi de %d sur le processus %d\n", buf, getpid());

        write(fvp[1], &buf, 3 * sizeof(int));

        close(pvf[0]);
        close(fvp[1]);

        exit(0);
    }

    close(pvf[0]);
    close(fvp[1]);


    write(pvf[1], &buf, 3 * sizeof(int));
    printf("Envoi de %d sur le processus %d\n", buf, getpid());

    read(fvp[0], &buf, 3 * sizeof(int));
    printf("Reception de %d sur le processus %d\n", buf, getpid());

    close(pvf[1]);
    close(fvp[0]);

    exit(0);
}